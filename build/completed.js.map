{"version":3,"sources":["completed.es6.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;kBAUe,UAAU,UAAV,EAAsB;AACnC,SAAO;AACL,SADK,iBACC,QADD,EACW;AACd,eAAS,OAAT,GAAmB;AACjB,eAAO,KAAK,KAAL,CAAW,aAAG,YAAH,CAAgB,YAAY,eAA5B,CAAX,CAAP;AACD;;AAED,eAAS,WAAT,CAAqB,MAArB,EAA6B;AAC3B,YAAM,KAAK,EAAX;;AAEA,+BAAQ,sBAAc,MAAd,CAAR,EAA+B,OAA/B,CAAuC,gBAAQ;AAAA,4BACxB,KAAK,KAAL,CAAW,GAAX,CADwB;AAAA;AAAA,cACtC,IADsC;AAAA,cAChC,IADgC;;AAE7C,aAAG,IAAH,IAAW,OAAO,IAAP,GAAc,EAAzB;AACD,SAHD;AAIA,eAAO,EAAP;AACD;;AAED,eAAS,IAAT,CAAc,SAAd,EAAyB,SAAzB,EAAoC;AAClC,YAAM,KAAK,EAAX;AADkC;AAAA;AAAA;;AAAA;AAElC,0DAA2B,uBAAe,SAAf,CAA3B,4GAAsD;AAAA;;AAAA;;AAAA,gBAA1C,IAA0C;AAAA,gBAApC,IAAoC;;AACpD,gBAAI,OAAO,KAAX;AACA,gBAAI,CAAC,UAAU,IAAV,CAAD,IAAoB,UAAU,IAAV,MAAoB,IAA5C,EACE,OAAO,IAAP;AACF,gBAAI,KAAK,MAAL,KAAgB,CAApB,EAAuB,OAAO,IAAP;AACvB,gBAAI,IAAJ,EAAU,GAAG,IAAH,CAAQ,IAAR;AAEX;AATiC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAUlC,2DAAmB,UAAnB;AAAA,gBAAW,KAAX;AAA+B,gBAAI,OAAO,UAAU,KAAV,CAAP,KAA2B,WAA/B,EAA4C;AACzE,iBAAG,IAAH,CAAQ,KAAR;AACD;AAFD;AAVkC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAalC,eAAO,EAAP;AACD;;AAED,eAAS,KAAT,CAAe,SAAf,EAA0B;AACxB,qBAAG,aAAH,CAAiB,YAAY,eAA7B,EAA8C,yBAAe,SAAf,EAA0B,IAA1B,EAAgC,CAAhC,CAA9C,EAAkF,OAAlF;AACD;;AAED,eAAS,MAAT,CAAgB,MAAhB;AAAA,6FAAwB,iBAAgB,IAAhB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,iCACY,KAAK,MAAL,CAAY;AAC5C,0BAAM;AADsC,mBAAZ,CADZ,EACf,IADe,gBACf,IADe,EACT,iBADS,gBACT,iBADS;AAKhB,2BALgB,GAKJ,SALI,EAMpB,SANoB,GAMR,YAAY,iBAAZ,CANQ,EAOpB,WAPoB,GAON,KAAK,SAAL,EAAgB,SAAhB,CAPM;;;AAStB,kCAAM,IAAN,CAAW,+DAAX;AACE;AADF,qBAEK,yBAAU,UAAV,EAAsB,WAAW,GAAX,CAAe;AAAA,2BAAS,UAAU,KAAV,CAAT;AAAA,mBAAf,CAAtB,CAFL,GAGG,IAHH,CAGQ,YAAY;AAClB,4BAAQ,GAAR,CAAY,gCAAZ;AACD,mBALD,EAKG,KALH,CAKS,UAAU,GAAV,EAAe;AACtB,4BAAQ,GAAR,CAAY,IAAI,OAAhB;AACD,mBAPD;;AATsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAxB;;AAAA;AAAA;AAAA;AAAA;AAkBD;AAtDI,GAAP;AAwDD,C;;AAnED;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAJA;AAMA,IAAM,WAAW,eAAK,IAAL,CAAU,SAAV,EAAqB,YAArB,CAAjB;AAAA,IACE,YAAY,+BADd","file":"completed.js","sourcesContent":["import axios from 'axios'\n// import PromiseSftp from 'promise-sftp'\nimport path from 'path'\nimport fs from 'fs'\nimport flatten from 'lodash/flatten'\nimport zipObject from 'lodash/zipObject'\n\nconst localDir = path.join(__dirname, '../assets/'),\n  remoteDir = '/home/phong/api.v1/vaithuhay/';\n\nexport default function (mainAssets) {\n  return {\n    apply(compiler) {\n      function readOld() {\n        return JSON.parse(fs.readFileSync(__dirname + '/current.json'));\n      }\n\n      function readCurrent(assets) {\n        const rs = {};\n\n        flatten(Object.values(assets)).forEach(item => {\n          const [file, hash] = item.split('?')\n          rs[file] = hash ? hash : ''\n        })\n        return rs;\n      }\n\n      function diff(oldAssets, newAssets) {\n        const rs = []\n        for (const [file, hash] of Object.entries(newAssets)) {\n          let push = false;\n          if (!oldAssets[file] || oldAssets[file] !== hash)\n            push = true;\n          if (hash.length === 0) push = true;\n          if (push) rs.push(file);\n\n        }\n        for (const file of mainAssets) if (typeof newAssets[file] === 'undefined') {\n          rs.push(file);\n        }\n        return rs;\n      }\n\n      function write(newAssets) {\n        fs.writeFileSync(__dirname + '/current.json', JSON.stringify(newAssets, null, 2), 'utf-8');\n      }\n\n      compiler.plugin('done', async function (stat) {\n        const {hash, assetsByChunkName} = stat.toJson({\n          hash: true\n        });\n\n        const oldAssets = readOld(),\n          newAssets = readCurrent(assetsByChunkName),\n          uploadFiles = diff(oldAssets, newAssets);\n\n        axios.post('https://api.v1.hungphongbk.com/vaithuhay/b/meta?key=assetHash', {\n          hash,\n          ...zipObject(mainAssets, mainAssets.map(asset => newAssets[asset]))\n        }).then(function () {\n          console.log('Resource hash has been updated')\n        }).catch(function (err) {\n          console.log(err.message);\n        })\n      })\n    }\n  }\n}\n"]}